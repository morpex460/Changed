# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–∏—Å—Ç–µ–º–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö Discord-–∏–Ω–≤–∞–π—Ç–æ–≤

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞  
**–ù–æ–≤—ã–π URL:** https://4ro8dtplj6of.space.minimax.io

---

## üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `allocate_invite()` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Supabase

### –°–∏–º–ø—Ç–æ–º—ã
- ‚ùå Edge Function –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ 500 –æ—à–∏–±–∫—É
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ: "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–≤–∞–π—Ç–æ–≤ –≤ –ø—É–ª–µ"
- ‚úÖ –í –ë–î –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–≤–∞–π—Ç—ã
- ‚ùå –§—É–Ω–∫—Ü–∏—è `allocate_invite()` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```sql
-- –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏:
SELECT allocate_invite();
-- ERROR: function allocate_invite() does not exist

-- –í —Ç–∞–±–ª–∏—Ü–µ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–≤–∞–π—Ç—ã:
SELECT COUNT(*) FROM invites_pool WHERE used_by IS NULL;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 4 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–≤–∞–π—Ç–∞
```

---

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `allocate_invite()`
```sql
CREATE OR REPLACE FUNCTION public.allocate_invite()
RETURNS JSON
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
    invite_record RECORD;
    result JSON;
BEGIN
    -- Find and update the first available invite
    UPDATE invites_pool 
    SET used_at = NOW()
    WHERE code = (
        SELECT code 
        FROM invites_pool 
        WHERE used_by IS NULL AND used_at IS NULL
        AND (expires_at IS NULL OR expires_at > NOW())
        ORDER BY created_at ASC 
        LIMIT 1
    )
    RETURNING code, invite_url, expires_at INTO invite_record;

    -- Check if we found an invite
    IF NOT FOUND THEN
        RETURN NULL;
    END IF;

    -- Return the invite data as JSON
    SELECT json_build_object(
        'code', invite_record.code,
        'invite_url', invite_record.invite_url,
        'expires_at', invite_record.expires_at
    ) INTO result;

    RETURN result;
END;
$$;
```

### 2. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Edge Function
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –ë–î
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 3. –ü–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ Edge Function –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ (–≤–µ—Ä—Å–∏—è 2)
- ‚úÖ Frontend –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å –Ω–æ–≤—ã–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- ‚úÖ –°–∞–π—Ç –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –Ω–æ–≤–æ–º URL

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Edge Function —Ç–µ—Å—Ç
```json
{
  "status_code": 200,
  "response_data": {
    "data": {
      "invite_url": "https://discord.gg/7AZXDuatT4",
      "code": "7AZXDuatT4"
    }
  }
}
```

### –§—É–Ω–∫—Ü–∏—è –ë–î —Ç–µ—Å—Ç
```sql
SELECT allocate_invite();
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: —É—Å–ø–µ—à–Ω—ã–π JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–Ω–≤–∞–π—Ç–∞
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–≤–∞–π—Ç–æ–≤
```sql
SELECT 
    COUNT(*) as total_invites,
    COUNT(CASE WHEN used_at IS NULL THEN 1 END) as available_invites,
    COUNT(CASE WHEN used_at IS NOT NULL THEN 1 END) as used_invites
FROM invites_pool;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- total_invites: 5
-- available_invites: 1  
-- used_invites: 4
```

---

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ SuccessPage –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
2. ‚úÖ –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ª—É—á–∏—Ç—å Discord –ò–Ω–≤–∞–π—Ç"
3. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
4. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—É—é —Å—Å—ã–ª–∫—É
5. ‚úÖ –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –≤ Discord –ø–æ —Å—Å—ã–ª–∫–µ
6. ‚úÖ –°—Å—ã–ª–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É–ª—É –∏–Ω–≤–∞–π—Ç–æ–≤
- ‚úÖ –¢–æ–ª—å–∫–æ Edge Function —Å service_role –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∏–Ω–≤–∞–π—Ç—ã
- ‚úÖ –ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ Proper error handling –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `invites_pool` —Ç–∞–±–ª–∏—Ü–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `allocate_invite()`
- ‚úÖ **Backend:** Supabase Edge Function `get-discord-invite`
- ‚úÖ **Frontend:** React —Ö—É–∫ `useDiscordInvite` —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- ‚úÖ **UI:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è –≤ `SuccessPage.tsx`

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ù–æ–≤—ã–π URL —Å–∞–π—Ç–∞
**https://4ro8dtplj6of.space.minimax.io**

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
1. **Supabase Edge Function:** `get-discord-invite` (–≤–µ—Ä—Å–∏—è 2)
   - URL: `https://opqwpbnwjfmxtddfbbfb.supabase.co/functions/v1/get-discord-invite`
   - –°—Ç–∞—Ç—É—Å: ACTIVE

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** —Ñ—É–Ω–∫—Ü–∏—è `allocate_invite()` —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **Frontend:** –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Discord –∏–Ω–≤–∞–π—Ç–æ–≤

### –î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Netlify
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `crypto_website_v2/dist`
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env.example`
3. Build command: `pnpm run build`
4. Publish directory: `dist`

---

## üîç Troubleshooting

### –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–≤–∞–π—Ç–æ–≤"
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–≤–∞–π—Ç–æ–≤
SELECT COUNT(*) FROM invites_pool WHERE used_at IS NULL;

-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–Ω–≤–∞–π—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
INSERT INTO invites_pool (code, invite_url) VALUES 
('NEW_CODE_1', 'https://discord.gg/NEW_CODE_1'),
('NEW_CODE_2', 'https://discord.gg/NEW_CODE_2');
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Edge Function
- Supabase Dashboard > Edge Functions > get-discord-invite > Logs
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**  
‚úÖ **Edge Function —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ç—É—Å 200)**  
‚úÖ **–§—É–Ω–∫—Ü–∏—è –ë–î `allocate_invite()` —Å–æ–∑–¥–∞–Ω–∞**  
‚úÖ **Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞**  
‚úÖ **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞**  
‚úÖ **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∏–Ω–≤–∞–π—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**  
‚úÖ **–°–∞–π—Ç –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –Ω–æ–≤–æ–º URL**  
‚úÖ **–ì–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**  

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**